**线性离散反演**

线性离散变换都可以表示为矩阵的形式

对于数列$A[a_0,a_1...]$，$B[b_0,b_1...]$，矩阵$M$满足$B=MA$，$A=M^{-1}B$，则变换$M$与变换$M^{-1}$互为反演变换

对$B=MA$，我们已知$B$，能否还原$A$，这就是逆变换的关注点，也称为反演

当施加在数列$A$上的运算不容易处理时，我们可以利用变换矩阵的性质在$O(n)$或者$O(nlgn)$的时间内转换到数列$B$，作等价运算完成后再通过逆变换还原回去，这就是$FFT$，$NTT$，$FWT$的思想，区间修改化差分点值修改也体现了这一思想

同时，如果满足某条件的数列$A$不容易求出的时候，我们可以先求出某个容易求的$MB$，再反演回来得到结果

**前缀和反演**
$$
\begin{array}{cc}
    b_i=\sum_{j=0}^i a_j\ & a_i=b_i-b_{i-1} \\ \\
    M=\left[
        \begin{matrix}
            1 & 0 & 0 & 0 & ... \\
            1 & 1 & 0 & 0 & ... \\
            1 & 1 & 1 & 0 & ... \\    
            1 & 1 & 1 & 1 & ... \\
            ... & ... & ... & ... & ...
        \end{matrix}
      \right] &
    M^{-1}=\left[
        \begin{matrix}
            1 & 0 & 0 & 0 & ... \\
            -1 & 1 & 0 & 0 & ... \\
            0 & -1 & 1 & 0 & ... \\    
            0 & 0 & -1 & 1 & ... \\
            ... & ... & ... & ... & ...
        \end{matrix}
        \right]
\end{array}
$$
证明，$MM^{-1}=E$，考虑$M^{-1}$第$y$列中的非零项

$$
\begin{array}{rl}
MM^{-1}\ _{x,y} & = M_{x,y}M^{-1}\ _{y,y}+M_{x,y+1}M^{-1}\ _{y+1,y} \\
				& = \left\{
						\begin{array}{cc}
							0 & x<y \\
							1 & x=y \\
							1-1 & x>y
						\end{array}
					\right. \\
				& = \left\{
						\begin{array}{cc}
                            1 & x=y \\
							0 & x \ne y
						\end{array}
					\right. \\ \\
\therefore MM^{-1}& = E
\end{array}
$$

这就是前缀和与差分，很好理解，可以推广到多维（定义域为$\{0,1\}$时为子集反演，详见下文）
**莫比乌斯反演**

数论反演，定义域为正整数，这里假定a，b下标都从1开始
$$
\begin{array}{cc}
    b_i=\sum_{j|i} a_j\ & a_i=\sum_{j|i} \mu(\frac i j)b_j \\ \\
    M=\left[
        \begin{matrix}
            1 & 0 & 0 & 0 & 0 & 0 & ... \\
            1 & 1 & 0 & 0 & 0 & 0 & ... \\
            1 & 0 & 1 & 0 & 0 & 0 & ... \\
            1 & 1 & 0 & 1 & 0 & 0 & ... \\
            1 & 0 & 0 & 0 & 1 & 0 & ... \\
            1 & 1 & 1 & 0 & 0 & 1 & ... \\
            ... & ... & ... & ... & ... & ... & ...
        \end{matrix}
      \right] &
    M^{-1}=\left[
        \begin{matrix}
            \mu(1) & 0 & 0 & 0 & 0 & 0 & ... \\
            \mu(2) & \mu(1) & 0 & 0 & 0 & 0 & ... \\
            \mu(3) & 0 & \mu(1) & 0 & 0 & 0 & ... \\
            \mu(4) & \mu(2) & 0 & \mu(1) & 0 & 0 & ... \\
            \mu(5) & 0 & 0 & 0 & \mu(1) & 0 & ... \\
            \mu(6) & \mu(3) & \mu(2) & 0 & 0 & \mu(1) & ... \\
            ... & ... & ... & ... & ... & ... & ... 
        \end{matrix}
        \right]
\end{array}
$$
证明，$MM^{-1}=E$，考虑$M$第$x$行与$M^{-1}$第$y$列中的第$k$项，显然第$k$项非零条件为$[k|x][k|y]$
$$
\begin{array}{rll}
MM^{-1}\ _{x,y} & = \sum_{k|x\ \and\ k|y}M_{x,k}M^{-1}\ _{k,y} \\
				& = \mu(\frac k y)[k|x][k|y] \\
				& = \mu(gcd(x,y)\frac k {lcm(x,y)})[k|lcm(x,y)] & gcd与lcm性质\\
				& = \mu(gcd(x,y))\mu(\frac k {lcm(x,y)})[k|lcm(x,y)] & \mu是积性函数\\
				& = \mu(gcd(x,y))
\sum_{i=1}^{gcd(x,y)} \mu(i) & \\
				& = \left\{
						\begin{array}{cc}
                            \mu(gcd(x,y))=1 & x=y \\
							0 & x \ne y
						\end{array}
					\right. 
					& \sum_{i=1}^x\mu=[x=1]\\ \\
\therefore MM^{-1}& = E
\end{array}
$$
莫比乌斯反演本质就是一个容斥的过程，因为和整除密切相关，很多$gcd$，$lcm$，互质的题目都可能会用到

**子集反演**

集合可以施加，与，交，交补运算，用二进制数表示集合，可转化为数的&，|，^运算

子集和可以用子集枚举$O(3^n)$或者$SOSDP$，或$FWT\_or$正变换或$FMT$，$O(n2^n)$来解决

子集反演则是子集和的逆变换过程，可以用子集枚举$O(3^n)$或者逆变换或$FMI$，$O(n2^n)$解决

这里的$j|i=i$表示$j$是$i$子集，$i-j$表示指定全集$i$，对$j$做补集运算，$bits\_cnt(x)$表示二进制数$x$为1的位的个数
$$
\begin{array}{cc}
    b_i=\sum_{j|i=i} a_j\ & a_i=\sum_{j|i=i} (-1)^{bits\_cnt(i - j)}b_j \\ \\
    M=\left[
        \begin{matrix}
            1 & 0 & 0 & 0 & 0 & 0 & ... \\
            1 & 1 & 0 & 0 & 0 & 0 & ... \\
            1 & 0 & 1 & 0 & 0 & 0 & ... \\
            1 & 1 & 1 & 1 & 0 & 0 & ... \\
            1 & 0 & 0 & 0 & 1 & 0 & ... \\
            1 & 1 & 0 & 0 & 1 & 1 & ... \\
            ... & ... & ... & ... & ... & ... & ...
        \end{matrix}
      \right] &
    M^{-1}=\left[
        \begin{matrix}
            1 & 0 & 0 & 0 & 0 & 0 & ... \\
            -1 & 1 & 0 & 0 & 0 & 0 & ... \\
            -1 & 0 & 1 & 0 & 0 & 0 & ... \\
            1 & -1 & -1 & 1 & 0 & 0 & ... \\
            -1 & 0 & 0 & 0 & 1 & 0 & ... \\
            1 & -1 & 0 & 0 & -1 & 1 & ... \\
            ... & ... & ... & ... & ... & ... & ... 
        \end{matrix}
        \right]
\end{array}
$$

如果把每个集合的状态${0,1}$看做一维，那么子集和的过程也就是多维前缀和的过程，那么只需要一维一维的作前缀，就可以的到子集和，一维一维的作差分，就可以还原数组

这就是经典的**快速莫比乌斯变换(FMT)**与**快速莫比乌斯逆变换FMI**


```cpp
void FMT(int a,int n) {
    for(int i = 0;i < n;i ++)
    	for(int j = 0;j < (1 << n);j ++)
            if ( j & (1 << i) ) p[j] += p[j - (1 << i)];
}
```

```cpp
void FMI(int a,int n) {
    for(int i = 0;i < n;i ++)
    	for(int j = 0;j < (1 << n);j ++)
            if ( j & (1 << i) ) p[j] -= p[j - (1 << i)];
}
```

**二项式反演**
$$
\begin{array}{cc}
    b_i=\sum_{j=0}^i \Big( \begin{array}{c} i \\ j \end{array} \Big) a_j & 
    a_i=\sum_{j=0}^i (-1)^{i-j} \Big( \begin{array}{c} i \\ j \end{array} \Big) b_j \\ \\
    M=\left[
        \begin{matrix}
            1 & 0 & 0 & 0 & ... \\
            1 & 1 & 0 & 0 & ... \\
            1 & 2 & 1 & 0 & ... \\    
            1 & 3 & 3 & 1 & ... \\
            ... & ... & ... & ... & ...
        \end{matrix}
      \right] &
    M^{-1}=\left[
        \begin{matrix}
            1 & 0 & 0 & 0 & ... \\
            -1 & 1 & 0 & 0 & ... \\
            1 & -2 & 1 & 0 & ... \\    
            -1 & 3 & -3 & 1 & ... \\
            ... & ... & ... & ... & ...
        \end{matrix}
        \right]
\end{array}
$$

二项式反演非常经典，举几个例子

**错排问题**，序列$1,2...n$重排后，全部错位的排列方案数有多少

我们记$a_i$为序列$1,2...i$重排后的全部错位的方案数，$b_i$为序列$1,2...i$重排后的错位个数为小于等于$i$的方案数，一共就$i$个数，那么$b_i$不就是全排列么，而**错位个数恰好为$j$的个数**相当于**$i$个数中选$j$个**乘上**$j$个数内部错排**

写成表达式就是$b_i=\sum_{j=0}^i \Big( \begin{array}{c} i \\ j \end{array} \Big) a_j = i!$

根据二项式反演容易得到$a_i=\sum_{j=0}^i (-1)^{i-j} \Big( \begin{array}{c} i \\ j \end{array} \Big) j! = \sum_{j=0}^i (-1)^{i-j} \frac{i!}{j!(i-j)!} j! = i!\sum_{j=0}^i \frac{(-1)^j}{j!}$

这就是著名的错排公式

**球染色问题**，有n个球，k种颜色，相邻的两个球不能染相同颜色，全部k种颜色必须全部使用，求染色方案数

记$a_i$为恰好使用$i$种颜色的方案数，$b_i $为使用小于等于$i$种颜色的方案数

第一个球$i$种染法，后面每个球$i-1$种染法，$b_i=i(i−1)^{n−1}$，而$b_i=\sum_{j=0}^i \Big( \begin{array}{c} i \\ j \end{array} \Big) a_j$，反演即可

**序列比大小**，给定序列$A$，序列$B$重排后，$a_i>b_i$对数等于$k$的方案数有多少





学习中......(未完待续)

**斯特林反演**

**单位根反演**

**最值反演**

**拉格朗日反演**

